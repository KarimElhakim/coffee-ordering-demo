<!DOCTYPE html>
<html>
<head>
  <title>KDS Data Checker</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
    .section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
    h2 { color: #4ade80; }
    pre { background: #000; padding: 10px; border-radius: 4px; overflow-x: auto; }
    .error { color: #f87171; }
    .success { color: #4ade80; }
    button { background: #4ade80; color: #000; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 5px; }
    button:hover { background: #22c55e; }
  </style>
</head>
<body>
  <h1>üîç KDS Data Inspector</h1>
  
  <div class="section">
    <h2>üìä Current Data Status</h2>
    <button onclick="checkData()">üîÑ Refresh Data</button>
    <button onclick="clearAll()">üóëÔ∏è Clear All Data</button>
    <button onclick="createTestOrder()">‚ú® Create Test Order</button>
    <div id="status"></div>
  </div>

  <div class="section">
    <h2>üì¶ KDS Tickets</h2>
    <div id="tickets"></div>
  </div>

  <div class="section">
    <h2>üõí Orders</h2>
    <div id="orders"></div>
  </div>

  <div class="section">
    <h2>üçî Order Items</h2>
    <div id="items"></div>
  </div>

  <script>
    function checkData() {
      const tickets = JSON.parse(localStorage.getItem('demo-kds-tickets') || '[]');
      const orders = JSON.parse(localStorage.getItem('demo-orders') || '[]');
      
      let html = '<div>';
      html += `<p class="${tickets.length > 0 ? 'success' : 'error'}">‚úì KDS Tickets: ${tickets.length}</p>`;
      html += `<p class="${orders.length > 0 ? 'success' : 'error'}">‚úì Orders: ${orders.length}</p>`;
      
      // Check order items
      let totalItems = 0;
      orders.forEach(order => {
        const items = JSON.parse(localStorage.getItem(`demo-order-items-${order.id}`) || '[]');
        totalItems += items.length;
      });
      html += `<p class="${totalItems > 0 ? 'success' : 'error'}">‚úì Total Order Items: ${totalItems}</p>`;
      html += '</div>';
      
      document.getElementById('status').innerHTML = html;
      
      // Display tickets
      if (tickets.length > 0) {
        document.getElementById('tickets').innerHTML = '<pre>' + JSON.stringify(tickets, null, 2) + '</pre>';
      } else {
        document.getElementById('tickets').innerHTML = '<p class="error">No tickets found</p>';
      }
      
      // Display orders
      if (orders.length > 0) {
        document.getElementById('orders').innerHTML = '<pre>' + JSON.stringify(orders.map(o => ({
          id: o.id,
          order_number: o.order_number,
          status: o.status,
          total: o.total_amount,
          customer: o.customer_name,
          phone: o.customer_phone,
          items_count: o.items?.length || 0
        })), null, 2) + '</pre>';
      } else {
        document.getElementById('orders').innerHTML = '<p class="error">No orders found</p>';
      }
      
      // Display items for each order
      let itemsHtml = '';
      orders.forEach(order => {
        const items = JSON.parse(localStorage.getItem(`demo-order-items-${order.id}`) || '[]');
        if (items.length > 0) {
          itemsHtml += `<h3>Order ${order.order_number || order.id.slice(0, 8)}</h3>`;
          itemsHtml += '<pre>' + JSON.stringify(items, null, 2) + '</pre>';
        }
      });
      document.getElementById('items').innerHTML = itemsHtml || '<p class="error">No items found</p>';
    }
    
    function clearAll() {
      if (confirm('Clear all data? This will remove all orders and tickets.')) {
        localStorage.removeItem('demo-kds-tickets');
        localStorage.removeItem('demo-orders');
        
        // Clear all order items
        const orders = JSON.parse(localStorage.getItem('demo-orders') || '[]');
        orders.forEach(order => {
          localStorage.removeItem(`demo-order-items-${order.id}`);
          localStorage.removeItem(`demo-order-payments-${order.id}`);
          localStorage.removeItem(`demo-order-item-options-${order.id}`);
        });
        
        localStorage.setItem('demo-orders', '[]');
        localStorage.setItem('demo-kds-tickets', '[]');
        
        alert('‚úÖ All data cleared!');
        checkData();
      }
    }
    
    function createTestOrder() {
      // Create a test order with KDS ticket
      const orderId = `order-test-${Date.now()}`;
      const orderNumber = `ORD-${String(Math.floor(Math.random() * 1000)).padStart(6, '0')}`;
      
      const order = {
        id: orderId,
        order_number: orderNumber,
        store_id: '1',
        table_id: null,
        channel: 'cashier',
        status: 'new',
        total_amount: 50.00,
        customer_name: 'Test Customer',
        customer_phone: '01234567890',
        location: 'test',
        created_at: new Date().toISOString(),
        items: [
          {
            id: `item-${orderId}-0`,
            order_id: orderId,
            menu_item_id: 'item-espresso',
            qty: 2,
            price_each: 25,
            note: 'Test note',
            menu_item: { name: 'Espresso' },
            options: [
              { key: 'Size', value: 'Medium', price_delta: 5 }
            ]
          }
        ]
      };
      
      // Store order
      const orders = JSON.parse(localStorage.getItem('demo-orders') || '[]');
      orders.push(order);
      localStorage.setItem('demo-orders', JSON.stringify(orders));
      
      // Store order items
      localStorage.setItem(`demo-order-items-${orderId}`, JSON.stringify(order.items));
      
      // Create KDS ticket
      const ticket = {
        id: `ticket-test-${Date.now()}`,
        order_id: orderId,
        station_id: 'station-bar',
        status: 'new',
        bumped_by: null,
        created_at: new Date().toISOString(),
      };
      
      const tickets = JSON.parse(localStorage.getItem('demo-kds-tickets') || '[]');
      tickets.push(ticket);
      localStorage.setItem('demo-kds-tickets', JSON.stringify(tickets));
      
      alert(`‚úÖ Test order created: ${orderNumber}\nOrder ID: ${orderId}\nTicket ID: ${ticket.id}`);
      checkData();
    }
    
    // Auto-load on page load
    window.onload = checkData;
  </script>
</body>
</html>

